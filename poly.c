//
//  poly.c
//  c
//

#include "poly.h"
#include "parameter.h"
#include <stdio.h>

#include "fips202.h"

/*---------------bit reverse order for N=1024-----------------*/
const uint16_t bitrev[N] = {
    0,   512,  256, 768,  128, 640,  384, 896,  64,  576,  320, 832,  192, 704,
    448, 960,  32,  544,  288, 800,  160, 672,  416, 928,  96,  608,  352, 864,
    224, 736,  480, 992,  16,  528,  272, 784,  144, 656,  400, 912,  80,  592,
    336, 848,  208, 720,  464, 976,  48,  560,  304, 816,  176, 688,  432, 944,
    112, 624,  368, 880,  240, 752,  496, 1008, 8,   520,  264, 776,  136, 648,
    392, 904,  72,  584,  328, 840,  200, 712,  456, 968,  40,  552,  296, 808,
    168, 680,  424, 936,  104, 616,  360, 872,  232, 744,  488, 1000, 24,  536,
    280, 792,  152, 664,  408, 920,  88,  600,  344, 856,  216, 728,  472, 984,
    56,  568,  312, 824,  184, 696,  440, 952,  120, 632,  376, 888,  248, 760,
    504, 1016, 4,   516,  260, 772,  132, 644,  388, 900,  68,  580,  324, 836,
    196, 708,  452, 964,  36,  548,  292, 804,  164, 676,  420, 932,  100, 612,
    356, 868,  228, 740,  484, 996,  20,  532,  276, 788,  148, 660,  404, 916,
    84,  596,  340, 852,  212, 724,  468, 980,  52,  564,  308, 820,  180, 692,
    436, 948,  116, 628,  372, 884,  244, 756,  500, 1012, 12,  524,  268, 780,
    140, 652,  396, 908,  76,  588,  332, 844,  204, 716,  460, 972,  44,  556,
    300, 812,  172, 684,  428, 940,  108, 620,  364, 876,  236, 748,  492, 1004,
    28,  540,  284, 796,  156, 668,  412, 924,  92,  604,  348, 860,  220, 732,
    476, 988,  60,  572,  316, 828,  188, 700,  444, 956,  124, 636,  380, 892,
    252, 764,  508, 1020, 2,   514,  258, 770,  130, 642,  386, 898,  66,  578,
    322, 834,  194, 706,  450, 962,  34,  546,  290, 802,  162, 674,  418, 930,
    98,  610,  354, 866,  226, 738,  482, 994,  18,  530,  274, 786,  146, 658,
    402, 914,  82,  594,  338, 850,  210, 722,  466, 978,  50,  562,  306, 818,
    178, 690,  434, 946,  114, 626,  370, 882,  242, 754,  498, 1010, 10,  522,
    266, 778,  138, 650,  394, 906,  74,  586,  330, 842,  202, 714,  458, 970,
    42,  554,  298, 810,  170, 682,  426, 938,  106, 618,  362, 874,  234, 746,
    490, 1002, 26,  538,  282, 794,  154, 666,  410, 922,  90,  602,  346, 858,
    218, 730,  474, 986,  58,  570,  314, 826,  186, 698,  442, 954,  122, 634,
    378, 890,  250, 762,  506, 1018, 6,   518,  262, 774,  134, 646,  390, 902,
    70,  582,  326, 838,  198, 710,  454, 966,  38,  550,  294, 806,  166, 678,
    422, 934,  102, 614,  358, 870,  230, 742,  486, 998,  22,  534,  278, 790,
    150, 662,  406, 918,  86,  598,  342, 854,  214, 726,  470, 982,  54,  566,
    310, 822,  182, 694,  438, 950,  118, 630,  374, 886,  246, 758,  502, 1014,
    14,  526,  270, 782,  142, 654,  398, 910,  78,  590,  334, 846,  206, 718,
    462, 974,  46,  558,  302, 814,  174, 686,  430, 942,  110, 622,  366, 878,
    238, 750,  494, 1006, 30,  542,  286, 798,  158, 670,  414, 926,  94,  606,
    350, 862,  222, 734,  478, 990,  62,  574,  318, 830,  190, 702,  446, 958,
    126, 638,  382, 894,  254, 766,  510, 1022, 1,   513,  257, 769,  129, 641,
    385, 897,  65,  577,  321, 833,  193, 705,  449, 961,  33,  545,  289, 801,
    161, 673,  417, 929,  97,  609,  353, 865,  225, 737,  481, 993,  17,  529,
    273, 785,  145, 657,  401, 913,  81,  593,  337, 849,  209, 721,  465, 977,
    49,  561,  305, 817,  177, 689,  433, 945,  113, 625,  369, 881,  241, 753,
    497, 1009, 9,   521,  265, 777,  137, 649,  393, 905,  73,  585,  329, 841,
    201, 713,  457, 969,  41,  553,  297, 809,  169, 681,  425, 937,  105, 617,
    361, 873,  233, 745,  489, 1001, 25,  537,  281, 793,  153, 665,  409, 921,
    89,  601,  345, 857,  217, 729,  473, 985,  57,  569,  313, 825,  185, 697,
    441, 953,  121, 633,  377, 889,  249, 761,  505, 1017, 5,   517,  261, 773,
    133, 645,  389, 901,  69,  581,  325, 837,  197, 709,  453, 965,  37,  549,
    293, 805,  165, 677,  421, 933,  101, 613,  357, 869,  229, 741,  485, 997,
    21,  533,  277, 789,  149, 661,  405, 917,  85,  597,  341, 853,  213, 725,
    469, 981,  53,  565,  309, 821,  181, 693,  437, 949,  117, 629,  373, 885,
    245, 757,  501, 1013, 13,  525,  269, 781,  141, 653,  397, 909,  77,  589,
    333, 845,  205, 717,  461, 973,  45,  557,  301, 813,  173, 685,  429, 941,
    109, 621,  365, 877,  237, 749,  493, 1005, 29,  541,  285, 797,  157, 669,
    413, 925,  93,  605,  349, 861,  221, 733,  477, 989,  61,  573,  317, 829,
    189, 701,  445, 957,  125, 637,  381, 893,  253, 765,  509, 1021, 3,   515,
    259, 771,  131, 643,  387, 899,  67,  579,  323, 835,  195, 707,  451, 963,
    35,  547,  291, 803,  163, 675,  419, 931,  99,  611,  355, 867,  227, 739,
    483, 995,  19,  531,  275, 787,  147, 659,  403, 915,  83,  595,  339, 851,
    211, 723,  467, 979,  51,  563,  307, 819,  179, 691,  435, 947,  115, 627,
    371, 883,  243, 755,  499, 1011, 11,  523,  267, 779,  139, 651,  395, 907,
    75,  587,  331, 843,  203, 715,  459, 971,  43,  555,  299, 811,  171, 683,
    427, 939,  107, 619,  363, 875,  235, 747,  491, 1003, 27,  539,  283, 795,
    155, 667,  411, 923,  91,  603,  347, 859,  219, 731,  475, 987,  59,  571,
    315, 827,  187, 699,  443, 955,  123, 635,  379, 891,  251, 763,  507, 1019,
    7,   519,  263, 775,  135, 647,  391, 903,  71,  583,  327, 839,  199, 711,
    455, 967,  39,  551,  295, 807,  167, 679,  423, 935,  103, 615,  359, 871,
    231, 743,  487, 999,  23,  535,  279, 791,  151, 663,  407, 919,  87,  599,
    343, 855,  215, 727,  471, 983,  55,  567,  311, 823,  183, 695,  439, 951,
    119, 631,  375, 887,  247, 759,  503, 1015, 15,  527,  271, 783,  143, 655,
    399, 911,  79,  591,  335, 847,  207, 719,  463, 975,  47,  559,  303, 815,
    175, 687,  431, 943,  111, 623,  367, 879,  239, 751,  495, 1007, 31,  543,
    287, 799,  159, 671,  415, 927,  95,  607,  351, 863,  223, 735,  479, 991,
    63,  575,  319, 831,  191, 703,  447, 959,  127, 639,  383, 895,  255, 767,
    511, 1023};
/*phi=19 19^(2N)%Q=1*/
const uint16_t phi[N] = {
    1,     11902, 350,   18275, 10693, 6654,  651,   6342,  3573,  915,   15539,
    6889,  12913, 14605, 3465,  5809,  708,   2735,  8171,  17167, 13114, 10617,
    83,    10917, 4363,  2665,  15544, 11100, 18069, 17860, 1631,  2213,  13009,
    14351, 199,   9074,  9819,  518,   8112,  15403, 11564, 13950, 10573, 16188,
    5288,  7514,  7500,  12414, 12305, 3925,  11861, 9708,  2611,  16517, 10633,
    11421, 3060,  14945, 1886,  14211, 2005,  11208, 1296,  15004, 5130,  7164,
    7499,  512,   16915, 15537, 3257,  215,   7088,  11968, 10778, 4509,  13921,
    11938, 6038,  12442, 739,   3037,  588,   12269, 12803, 14128, 1831,  4756,
    4528,  12597, 17995, 3463,  12846, 9790,  16881, 16395, 8710,  17661, 7055,
    6295,  12514, 2988,  11279, 13552, 5926,  6594,  9604,  3775,  12497, 3417,
    5329,  16238, 10058, 6414,  18030, 14507, 12072, 14142, 4043,  9656,  11317,
    5003,  16288, 18348, 36,    4513,  12600, 12745, 1290,  17324, 9108,  17376,
    6086,  12315, 10305, 15361, 920,   638,   8639,  2104,  12771, 1924,  9064,
    9812,  10103, 7447,  15347, 7397,  13999, 211,   14905, 118,   6205,  9312,
    15089, 14992, 9698,  16583, 2628,  16088, 7580,  6058,  17081, 505,   3039,
    4632,  12969, 17529, 5263,  4892,  17183, 16364, 1310,  15735, 16108, 14216,
    2637,  12608, 1300,  7313,  13384, 16815, 2418,  5123,  2738,  16565, 18217,
    9788,  5830,  6848,  12870, 510,   253,   6627,  14818, 15325, 14111, 6059,
    17239, 855,   752,   10299, 5138,  10215, 4348,  8465,  10294, 13470, 13227,
    9934,  2767,  11496, 18335, 13316, 2566,  15484, 16292, 10657, 6403,  6484,
    73,    2495,  7117,  6899,  10203, 17935, 13481, 10030, 14185, 2023,  6273,
    7596,  13278, 8647,  2184,  3438,  10688, 2443,  17334, 7132,  16421, 16076,
    14687, 4535,  15428, 12943, 17364, 13965, 18427, 2320,  16333, 948,   9574,
    15375, 14527, 17247, 361,   1733,  15752, 16694, 7676,  5804,  13815, 3770,
    17976, 16954, 5947,  16907, 16477, 567,   15854, 14120, 15959, 10386, 451,
    3799,  15306, 17106, 11530, 14808, 8238,  3549,  7752,  7139,  16060, 14343,
    17368, 6274,  14267, 1038,  16540, 13073, 5523,  2668,  16018, 12150, 8746,
    3741,  1222,  607,   10369, 2903,  16282, 2235,  18185, 16017, 5365,  2318,
    2488,  8778,  4449,  12422, 17113, 12709, 17258, 5797,  4918,  9261,  7031,
    15575, 8630,  5584,  15921, 502,   4992,  5225,  14498, 3883,  15014, 7126,
    1495,  5645,  11705, 14729, 4624,  12343, 8717,  8810,  9505,  5189,  13633,
    12700, 15836, 2647,  12504, 12999, 7779,  15132, 10723, 13487, 11151, 1602,
    10700, 16236, 3101,  5236,  1469,  9554,  16459, 7527,  1058,  2577,  1640,
    17166, 13765, 16959, 6737,  224,   18070, 11329, 1981,  2055,  7804,  17754,
    3316,  1979,  11744, 18082, 18274, 6181,  12996, 7089,  14082, 11128, 4865,
    5177,  6914,  5516,  3519,  3362,  15072, 15421, 326,   9122,  3502,  3791,
    2081,  12543, 9463,  2996,  15882, 15582, 10367, 15965, 2997,  2439,  16702,
    5732,  9612,  6826,  9394,  11243, 17141, 14171, 8625,  1373,  8296,  11844,
    9619,  16408, 9532,  13182, 18260, 5450,  1344,  14877, 9575,  8844,  12085,
    2971,  8593,  7602,  11874, 16970, 8475,  4074,  2178,  5758,  6547,  6103,
    11469, 7673,  14189, 12765, 3268,  2106,  954,   18213, 17601, 14490, 3728,
    2425,  6563,  12205, 11358, 13727, 13410, 12906, 11518, 1015,  2823,  14420,
    11101, 14791, 800,   10172, 3505,  2631,  1488,  14496, 4676,  4525,  1285,
    13113, 7358,  18166, 7920,  15911, 7050,  2084,  15116, 4552,  329,   7962,
    14844, 11416, 15727, 14072, 778,   6390,  14238, 6107,  5871,  15572, 8787,
    12465, 10988, 15474, 11736, 15031, 2742,  8874,  1184,  9156,  16267, 8035,
    16086, 10434, 9243,  2042,  9275,  14246, 19,    4942,  6650,  15431, 404,
    15828, 12369, 9900,  12588, 17385, 313,   1860,  5718,  1000,  10536, 18206,
    13452, 15099, 7785,  12812, 9537,  17393, 1577,  4660,  9165,  13769, 408,
    8137,  11517, 7546,  12556, 5181,  7542,  14607, 3781,  6509,  2231,  9842,
    6664,  16162, 16953, 6988,  16557, 12644, 8307,  13735, 13469, 14670, 12599,
    843,   4163,  122,   12743, 462,   17697, 14236, 2841,  7460,  17401, 11947,
    1229,  10189, 6191,  8581,  5305,  7085,  13450, 9728,  8024,  275,   6584,
    4085,  5641,  6196,  2019,  11939, 6437,  5626,  4124,  15202, 14041, 2404,
    11172, 11915, 3628,  10370, 16356, 16632, 12300, 18147, 10111, 10498, 4445,
    1680,  7378,  16577, 18026, 3765,  5014,  9007,  16570, 1473,  11538, 17859,
    1996,  14688, 16579, 16426, 16247, 9624,  9086,  13594, 6772,  11268, 10776,
    17571, 8172,  10636, 3085,  17567, 12260, 2892,  14544, 16818, 684,   12015,
    18204, 2526,  6077,  15795, 7155,  16783, 5036,  12789, 11465, 15364, 17480,
    12122, 16677, 3110,  3020,  18123, 6319,  2098,  7627,  12462, 15098, 11512,
    7919,  4009,  6700,  2242,  7297,  11031, 10196, 8353,  18365, 1716,  13066,
    10744, 14989, 4504,  11178, 9595,  2442,  14276, 6782,  1257,  7832,  783,
    13116, 15988, 6457,  4037,  11124, 12042, 13237, 18356, 6267,  9916,  14667,
    6124,  9076,  5172,  15156, 1374,  14329, 1642,  172,   1081,  4901,  9690,
    4807,  15315, 5047,  14680, 10047, 4523,  14180, 16245, 14288, 11351, 5457,
    9755,  8880,  13371, 11256, 16301, 11684, 4416,  15707, 15661, 16571, 13375,
    11888, 17701, 14620, 18153, 11059, 12598, 1387,  10539, 6192,  2050,  9527,
    8971,  16510, 6240,  11453, 1571,  8589,  15293, 12653, 16829, 4630,  10023,
    309,   9551,  15985, 6477,  17071, 10516, 2558,  12433, 16637, 6288,  16555,
    7273,  18319, 7214,  15399, 18012, 16009, 15630, 17951, 14332, 6859,  14494,
    4360,  3825,  16813, 18111, 4423,  16331, 9750,  8765,  2395,  7872,  18135,
    10773, 6298,  10218, 8293,  13004, 8569,  16882, 14319, 11653, 16307, 4857,
    9058,  12132, 18257, 6610,  10212, 14455, 16631, 8608,  13011, 1289,  899,
    8758,  12772, 13826, 9414,  9654,  277,   15780, 4785,  11533, 12681, 18291,
    14430, 5599,  13721, 9395,  9770,  7176,  10406, 885,   10799, 14822, 11786,
    1842,  14541, 17978, 1277,  10062, 4558,  997,   16506, 13931, 7571,  9538,
    2683,  7110,  17400, 45,    8771,  6363,  9972,  15090, 1199,  3356,  14124,
    13321, 18159, 1493,  14698, 6426,  965,   1671,  5956,  13427, 16380, 7352,
    337,   11013, 974,   16624, 9106,  12005, 537,   13556, 3620,  7319,  9478,
    15629, 17793, 13982, 1669,  12097, 12727, 12793, 3473,  8860,  17405, 4256,
    11536, 12488, 773,   2179,  812,   5532,  7705,  735,   1940,  11764, 15412,
    6841,  7295,  5660,  9496,  8669,  270,   6198,  2335,  12639, 11562, 8579,
    9873,  16504, 6194,  7421,  11239, 16730, 2673,  17121, 13900, 1625,  6830,
    1130,  12643, 8407,  1644,  9475,  3977,  16743, 16731, 663,   12589, 10854,
    12318, 11187, 16411, 7654,  10160, 3840,  16864, 16824, 15211, 10829, 15146,
    11385, 7103,  6168,  16028, 2139,  8419,  1150,  15803, 15407, 4410,  9069,
    13561, 3674,  4516,  17237, 13795, 5359,  15148, 16756, 11529, 2906,  6793,
    3148,  18126, 14253, 2625,  17248, 15533, 9209,  14099, 10699, 13039, 2751,
    15161, 5585,  16079, 852,   16771, 15918, 8156,  4534,  15200, 8938,  11296,
    13123, 9839,  17362, 15112, 12243, 5982,  9518,  10771, 13360, 3016,  7381,
    4919,  2730,  10709, 12756, 6251,  3814,  5541,  14141, 3885,  9306,  14782,
    10812, 12460, 5435,  951,   940,   1056,  15639, 6009,  17511, 1788,  9094,
    15232, 2709,  4063,  8067,  14145, 5201,  10706, 13916, 9720,  1932,  10328,
    12612};
/*invphi=5821*/

const uint16_t invphi[N] = {
    1,     6531,  158,   18083, 12091, 17782, 11779, 7740,  12624, 14968, 3828,
    5520,  11544, 2894,  17518, 14860, 16220, 16802, 573,   364,   7333,  2889,
    15768, 14070, 7516,  18350, 7816,  5319,  1266,  10262, 15698, 17725, 3429,
    17137, 7225,  16428, 4222,  16547, 3488,  15373, 7012,  7800,  1916,  15822,
    8725,  6572,  14508, 6128,  6019,  10933, 10919, 13145, 2245,  7860,  4483,
    6869,  3030,  10321, 17915, 8614,  9359,  18234, 4082,  5424,  5688,  5833,
    13920, 18397, 85,    2145,  13430, 7116,  8777,  14390, 4291,  6361,  3926,
    403,   12019, 8375,  2195,  13104, 15016, 5936,  14658, 8829,  11839, 12507,
    4881,  7154,  15445, 5919,  12138, 11378, 772,   9723,  2038,  1552,  8643,
    5587,  14970, 438,   5836,  13905, 13677, 16602, 4305,  5630,  6164,  17845,
    15396, 17694, 5991,  12395, 6495,  4512,  13924, 7655,  6465,  11345, 18218,
    15176, 2896,  1518,  17921, 10934, 11269, 13303, 1186,  3906,  3058,  8859,
    17485, 2100,  16113, 6,     4468,  1069,  5490,  3005,  13898, 3746,  2357,
    2012,  11301, 1099,  15990, 7745,  14995, 16249, 9786,  5155,  10837, 12160,
    16410, 4248,  8403,  4952,  498,   8230,  11534, 11316, 15938, 18360, 11949,
    12030, 7776,  2141,  2949,  15867, 5117,  98,    6937,  15666, 8499,  5206,
    4963,  8139,  9968,  14085, 8218,  13295, 8134,  17681, 17578, 1194,  12374,
    4322,  3108,  3615,  11806, 18180, 17923, 5563,  11585, 12603, 8645,  216,
    1868,  15695, 13310, 16015, 1618,  5049,  11120, 17133, 5825,  15796, 4217,
    2325,  2698,  17123, 2069,  1250,  13541, 13170, 904,   5464,  13801, 15394,
    17928, 1352,  12375, 10853, 2345,  15805, 1850,  8735,  3441,  3344,  9121,
    12228, 18315, 3528,  18222, 4434,  11036, 3086,  10986, 8330,  8621,  9369,
    16509, 5662,  16329, 9794,  17795, 17513, 3072,  8128,  6118,  12347, 1057,
    9325,  1109,  17143, 4187,  9158,  16391, 9190,  7999,  2347,  10398, 2166,
    9277,  17249, 9559,  15691, 3402,  6697,  2959,  7445,  5968,  9646,  2861,
    12562, 12326, 4195,  12043, 17655, 4361,  2706,  7017,  3589,  10471, 18104,
    13881, 3317,  16349, 11383, 2522,  10513, 267,   11075, 5320,  17148, 13908,
    13757, 3937,  16945, 15802, 14928, 8261,  17633, 3642,  7332,  4013,  15610,
    17418, 6915,  5527,  5023,  4706,  7075,  6228,  11870, 16008, 14705, 3943,
    832,   220,   17479, 16327, 15165, 5668,  4244,  10760, 6964,  12330, 11886,
    12675, 16255, 14359, 9958,  1463,  6559,  10831, 9840,  15462, 6348,  9589,
    8858,  3556,  17089, 12983, 173,   5251,  8901,  2025,  8814,  6589,  10137,
    17060, 9808,  4262,  1292,  7190,  9039,  11607, 8821,  12701, 1731,  15994,
    15436, 2468,  8066,  2851,  2551,  15437, 8970,  5890,  16352, 14642, 14931,
    9311,  18107, 3012,  3361,  15071, 14914, 12917, 11519, 13256, 13568, 7305,
    4351,  11344, 5437,  12252, 159,   351,   6689,  16454, 15117, 679,   10629,
    16378, 16452, 7104,  363,   18209, 11696, 1474,  4668,  1267,  16793, 15856,
    17375, 10906, 1974,  8879,  16964, 13197, 15332, 2197,  7733,  16831, 7282,
    4946,  7710,  3301,  10654, 5434,  5929,  15786, 2597,  5733,  4800,  13244,
    8928,  9623,  9716,  6090,  13809, 3704,  6728,  12788, 16938, 11307, 3419,
    14550, 3935,  13208, 13441, 17931, 2512,  12849, 9803,  2858,  11402, 9172,
    13515, 12636, 1175,  5724,  1320,  6011,  13984, 9655,  15945, 16115, 13068,
    2416,  248,   16198, 2151,  15530, 8064,  17826, 17211, 14692, 9687,  6283,
    2415,  15765, 12910, 5360,  1893,  17395, 4166,  12159, 1065,  4090,  2373,
    11294, 10681, 14884, 10195, 3625,  6903,  1327,  3127,  14634, 17982, 8047,
    2474,  4313,  2579,  17866, 1956,  1526,  12486, 1479,  457,   14663, 4618,
    12629, 10757, 1739,  2681,  16700, 18072, 5821,  8105,  16501, 8713,  4517,
    7727,  13232, 4288,  10366, 14370, 15724, 3201,  9339,  16645, 922,   12424,
    2794,  17377, 17493, 17482, 12998, 5973,  7621,  3651,  9127,  14548, 4292,
    12892, 14619, 12182, 5677,  7724,  15703, 13514, 11052, 15417, 5073,  7662,
    8915,  12451, 6190,  3321,  1071,  8594,  5310,  7137,  9495,  3233,  13899,
    10277, 2515,  1662,  17581, 2354,  12848, 3272,  15682, 5394,  7734,  4334,
    9224,  2900,  1185,  15808, 4180,  307,   15285, 11640, 15527, 6904,  1677,
    3285,  13074, 4638,  1196,  13917, 14759, 4872,  9364,  14023, 3026,  2630,
    17283, 10014, 16294, 2405,  12265, 11330, 7048,  3287,  7604,  3222,  1609,
    1569,  14593, 8273,  10779, 2022,  7246,  6115,  7579,  5844,  17770, 1702,
    1690,  14456, 8958,  16789, 10026, 5790,  17303, 11603, 16808, 4533,  1312,
    15760, 1703,  7194,  11012, 12239, 1929,  8560,  9854,  6871,  5794,  16098,
    12235, 18163, 9764,  8937,  12773, 11138, 11592, 3021,  6669,  16493, 17698,
    10728, 12901, 17621, 16254, 17660, 5945,  6897,  14177, 1028,  9573,  14960,
    5640,  5706,  6336,  16764, 4451,  640,   2804,  8955,  11114, 14813, 4877,
    17896, 6428,  9327,  1809,  17459, 7420,  18096, 11081, 2053,  5006,  12477,
    16762, 17468, 12007, 3735,  16940, 274,   5112,  4309,  15077, 17234, 3343,
    8461,  12070, 9662,  18388, 1033,  11323, 15750, 8895,  10862, 4502,  1927,
    17436, 13875, 8371,  17156, 455,   3892,  16591, 6647,  3611,  7634,  17548,
    8027,  11257, 8663,  9038,  4712,  12834, 4003,  142,   5752,  6900,  13648,
    2653,  18156, 8779,  9019,  4607,  5661,  9675,  17534, 17144, 5422,  9825,
    1802,  3978,  8221,  11823, 176,   6301,  9375,  13576, 2126,  6780,  4114,
    1551,  9864,  5429,  10140, 8215,  12135, 7660,  298,   10561, 16038, 9668,
    8683,  2102,  14010, 322,   1620,  14608, 14073, 3939,  11574, 4101,  482,
    2803,  2424,  421,   3034,  11219, 114,   11160, 1878,  12145, 1796,  6000,
    15875, 7917,  1362,  11956, 2448,  8882,  18124, 8410,  13803, 1604,  5780,
    3140,  9844,  16862, 6980,  12193, 1923,  9462,  8906,  16383, 12241, 7894,
    17046, 5835,  7374,  280,   3813,  732,   6545,  5058,  1862,  2772,  2726,
    14017, 6749,  2132,  7177,  5062,  9553,  8678,  12976, 7082,  4145,  2188,
    4253,  13910, 8386,  3753,  13386, 3118,  13626, 8743,  13532, 17352, 18261,
    16791, 4104,  17059, 3277,  13261, 9357,  12309, 3766,  8517,  12166, 77,
    5196,  6391,  7309,  14396, 11976, 2445,  5317,  17650, 10601, 17176, 11651,
    4157,  15991, 8838,  7255,  13929, 3444,  7689,  5367,  16717, 68,    10080,
    8237,  7402,  11136, 16191, 11733, 14424, 10514, 6921,  3335,  5971,  10806,
    16335, 12114, 310,   15413, 15323, 1756,  6311,  953,   3069,  6968,  5644,
    13397, 1650,  11278, 2638,  12356, 15907, 229,   6418,  17749, 1615,  3889,
    15541, 6173,  866,   15348, 7797,  10261, 862,   7657,  7165,  11661, 4839,
    9347,  8809,  2186,  2007,  1854,  3745,  16437, 574,   6895,  16960, 1863,
    9426,  13419, 14668, 407,   1856,  11055, 16753, 13988, 7935,  8322,  286,
    6133,  1801,  2077,  8063,  14805, 6518,  7261,  16029, 4392,  3231,  14309,
    12807, 11996, 6494,  16414, 12237, 12792, 14348, 11849, 18158, 10409, 8705,
    4983,  11348, 13128, 9852,  12242, 8244,  17204, 6486,  1032,  10973, 15592,
    4197,  736,   17971, 5690,  18311, 14270, 17590, 5834,  3763,  4964,  4698,
    10126, 5789,  1876,  11445, 1480,  2271,  11769, 8591,  16202, 11924, 14652,
    3826,  10891, 13252, 5877,  10887, 6916,  10296, 18025, 4664,  9268,  13773,
    16856, 1040,  8896,  5621,  10648, 3334,  4981,  227,   7897,  17433, 12715,
    16573, 18120, 1048,  5845,  8533,  6064,  2605,  18029, 3002,  11783, 13491,
    18414};

/*--------------------------------------------------------------
Input: polynomial a, b
Output: polynomial c=a+b
----------------------------------------------------------------*/

void poly_add(uint16_t *c, const uint16_t *a, const uint16_t *b) {
    int i;
    for (i = 0; i < N; i++)
        c[i] = (a[i] + b[i]) % Q;
}

/*--------------------------------------------------------------
 Input: byte array a
 Output: polynomial r in R_q=Z_Q[X]/X^N+1
 ----------------------------------------------------------------*/

void byte_topoly(unsigned char *a, uint16_t *r)

{
    int i;
    for (i = 0; i < N / 8; i++) {
        r[8 * i + 0] = a[15 * i + 0] | (((uint16_t)a[15 * i + 1] & 0x7f) << 8);
        r[8 * i + 1] = (a[15 * i + 1] >> 7) | (((uint16_t)a[15 * i + 2]) << 1) |
                       (((uint16_t)a[15 * i + 3] & 0x3f) << 9);
        r[8 * i + 2] = (a[15 * i + 3] >> 6) | (((uint16_t)a[15 * i + 4]) << 2) |
                       (((uint16_t)a[15 * i + 5] & 0x1f) << 10);
        r[8 * i + 3] = (a[15 * i + 5] >> 5) | (((uint16_t)a[15 * i + 6]) << 3) |
                       (((uint16_t)a[15 * i + 7] & 0xf) << 11);
        r[8 * i + 4] = (a[15 * i + 7] >> 4) | (((uint16_t)a[15 * i + 8]) << 4) |
                       (((uint16_t)a[15 * i + 9] & 0x07) << 12);
        r[8 * i + 5] = (a[15 * i + 9] >> 3) |
                       (((uint16_t)a[15 * i + 10]) << 5) |
                       (((uint16_t)a[15 * i + 11] & 0x03) << 13);
        r[8 * i + 6] = (a[15 * i + 11] >> 2) |
                       (((uint16_t)a[15 * i + 12]) << 6) |
                       (((uint16_t)a[15 * i + 13] & 0x01) << 14);
        r[8 * i + 7] =
            (a[15 * i + 13] >> 1) | (((uint16_t)a[15 * i + 14]) << 7);
    }
}

/*--------------------------------------------------------------
 Input: poly a
 Output: polynomial r in R_q=Z_Q[X]/X^N+1
 ----------------------------------------------------------------*/
void poly_tobyte(unsigned char *a, uint16_t *r) {
    int i;
    uint16_t t0, t1, t2, t3, t4, t5, t6, t7;
    for (i = 0; i < N / 8; i++) {
        t0 = r[8 * i + 0];
        t1 = r[8 * i + 1];
        t2 = r[8 * i + 2];
        t3 = r[8 * i + 3];
        t4 = r[8 * i + 4];
        t5 = r[8 * i + 5];
        t6 = r[8 * i + 6];
        t7 = r[8 * i + 7];

        a[15 * i + 0] = t0 & 0xff;
        a[15 * i + 1] = (t0 >> 8) | (t1 << 7) & 0xff;
        a[15 * i + 2] = (t1 >> 1) & 0xff;
        a[15 * i + 3] = (t1 >> 9) | (t2 << 6) & 0xff;
        a[15 * i + 4] = (t2 >> 2) & 0xff;
        a[15 * i + 5] = (t2 >> 10) | (t3 << 5) & 0xff;
        a[15 * i + 6] = (t3 >> 3) & 0xff;
        a[15 * i + 7] = (t3 >> 11) | (t4 << 4) & 0xff;
        a[15 * i + 8] = (t4 >> 4) & 0xff;
        a[15 * i + 9] = (t4 >> 12) | (t5 << 3) & 0xff;
        a[15 * i + 10] = (t5 >> 5) & 0xff;
        a[15 * i + 11] = (t5 >> 13) | (t6 << 2) & 0xff;
        a[15 * i + 12] = (t6 >> 6) & 0xff;
        a[15 * i + 13] = (t6 >> 14) | (t7 << 1) & 0xff;
        a[15 * i + 14] = (t7 >> 7) & 0xff;
    }
}

void poly_tobyte_s(unsigned char *a, uint16_t *r) {
    int i;
    uint16_t t0, t1, t2, t3, t4, t5, t6, t7;
    for (i = 0; i < N / 8; i++) {
        t0 = r[8 * i + 0];
        t1 = r[8 * i + 1];
        t2 = r[8 * i + 2];
        t3 = r[8 * i + 3];
        t4 = r[8 * i + 4];
        t5 = r[8 * i + 5];
        t6 = r[8 * i + 6];
        t7 = r[8 * i + 7];

        a[3 * i + 0] = (t0 | (t1 << 3) | (t2 << 6)) & 0xff;
        a[3 * i + 1] = ((t2 >> 2) | (t3 << 1) | (t4 << 4) | (t5 << 7)) & 0xff;
        a[3 * i + 2] = ((t5 >> 1) | (t6 << 2) | (t7 << 5)) & 0xff;
    }
}

void byte_topoly_s(unsigned char *a, uint16_t *r)

{
    int i;
    for (i = 0; i < N / 8; i++) {
        r[8 * i + 0] = a[3 * i + 0] & 0x7;
        r[8 * i + 1] = (a[3 * i + 0] >> 3) & 0x7;
        r[8 * i + 2] =
            (((a[3 * i + 0] >> 6) & 0x3) | (a[3 * i + 1] << 2)) & 0x7;
        r[8 * i + 3] = (a[3 * i + 1] >> 1) & 0x7;
        r[8 * i + 4] = (a[3 * i + 1] >> 4) & 0x7;
        r[8 * i + 5] =
            ((((a[3 * i + 1] >> 7) & 0x1) | (a[3 * i + 2]) << 1)) & 0x7;
        r[8 * i + 6] = (a[3 * i + 2] >> 2) & 0x7;
        r[8 * i + 7] = (a[3 * i + 2] >> 5) & 0x7;
    }
}

/*---------------------------------------------
 Input: polynomial a in normal order
 Output: polynomial a in bitrev order
 ---------------------------------------------*/

void poly_bitrev(uint16_t *a) {
    int i, t;
    for (i = 0; i < N; i++) {
        if (i < bitrev[i]) {
            t = a[i];
            a[i] = a[bitrev[i]];
            a[bitrev[i]] = t;
        }
    }
}

/*---------------------------------------------------------------------
 Input: polynomial a ,b
 Output: polynomial c, c[i]=a[i]*b[i]%Q
 ---------------------------------------------------------------------*/

void poly_pointwise(uint16_t *c, const uint16_t *a, const uint16_t *b) {
    int i;
    uint16_t t[N];
    for (i = 0; i < N; i++) {
        // t[i]=montgomery_reduce(a[i]*3186);//3186=(2^18)^2%12289=R^2%Q
        // c[i]=montgomery_reduce(t[i]*b[i]);
        c[i] = a[i] * b[i] % Q;

        // c[i]=montgomery_reduce(a[i]*b[i]);
    }
}

void poly_ntt(uint16_t *r) {
    uint16_t m, i, j, j_1, V, t, U, j_2;
    t = N;
    for (m = 1; m < N; m = 2 * m) {
        t = t / 2;
        for (i = 0; i < m; i++) {
            j_1 = 2 * i * t;
            j_2 = j_1 + t - 1;
            for (j = j_1; j <= j_2; j++) {
                U = r[j] % Q;
                V = r[j + t] * phi[m + i] % Q;
                r[j] = (U + V) % Q;
                r[j + t] = (U - V + 4 * Q) % Q;
            }
        }
    }
    poly_bitrev(r);
}

void poly_invntt(uint16_t *r)

{

    uint16_t t, m, h, i, j, j_1, j_2, S, U, V;
    t = 1;
    poly_bitrev(r);
    for (m = N; m > 1; m = m / 2) {
        j_1 = 0;
        h = m / 2;
        for (i = 0; i < h; i++) {
            j_2 = j_1 + t - 1;
            S = invphi[h + i];
            for (j = j_1; j <= j_2; j++) {

                U = r[j] % Q;
                V = r[j + t] % Q;
                r[j] = (U + V) % Q;
                r[j + t] = ((U - V + 4 * Q) * S) % Q;
            }
            j_1 = j_1 + 2 * t;
        }
        t = 2 * t;
    }

    for (j = 0; j < N; j++)
        r[j] = (r[j] * 18415) % Q; // 18415*n=1%Q
}

void poly_gen_a(uint16_t *a, const unsigned char *seed) {
    unsigned int ctr = 0;
    uint16_t val;
    uint64_t state[25];
    uint8_t buf[SHAKE128_RATE];
    uint8_t extseed[PKE_SEED_BYTES + 1];
    int i, j;

    for (i = 0; i < PKE_SEED_BYTES; i++)
        extseed[i] = seed[i];

    for (i = 0; i < N / 64; i++) /* generate a in blocks of 64 coefficients */
    {
        ctr = 0;
        extseed[PKE_SEED_BYTES] =
            i; /* domain-separate the 16 independent calls */
        shake128_absorb(state, extseed, PKE_SEED_BYTES + 1);
        while (ctr < 64) /* Very unlikely to run more than once */
        {
            shake128_squeezeblocks(buf, 1, state);
            for (j = 0; j < SHAKE128_RATE && ctr < 64; j += 2) {
                val = (buf[j] | ((uint16_t)buf[j + 1] << 8));
                if (val < 5 * Q) {
                    a[i * 64 + ctr] = val;
                    ctr++;
                }
            }
        }
    }
}
